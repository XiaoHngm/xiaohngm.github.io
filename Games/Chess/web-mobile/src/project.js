window.__require=function t(e,i,n){function a(r,c){if(!i[r]){if(!e[r]){var s=r.split("/");if(s=s[s.length-1],!e[s]){var l="function"==typeof __require&&__require;if(!c&&l)return l(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+r+"'")}}var h=i[r]={exports:{}};e[r][0].call(h.exports,function(t){return a(e[r][1][t]||t)},h,h.exports,t,e,i,n)}return i[r].exports}for(var o="function"==typeof __require&&__require,r=0;r<n.length;r++)a(n[r]);return a}({Army:[function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}cc._RF.push(e,"f82fcO+8WtHNrJPuf9Y/IxH","Army"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.father=cc.find("scene1/window1/battle").getComponent("Battle"),this._genArray=this.father._genArray,this.row_num=this.father.row_num,this.col_num=this.father.col_num,this.object_by_loc=this._genArray(this.row_num,this.col_num),this.updateObjectByLocation(),this._double_object_by_loc=this._genArray(2*this.row_num-1,2*this.col_num-1),this._updateDoubleObjectByLocation(),this.unit_advantage=this._getUnitAdvantage(),this.last_selected_unit=null,this.node.on("select unit",this._eventSelectUnit,this)},onEnable:function(){},start:function(){},update:function(t){},lateUpdate:function(t){},onDisable:function(){},beforeDestroy:function(){},onDestroy:function(){},updateObjectByLocation:function(){for(var t=0;t<this.row_num;t++)for(var e=0;e<this.col_num;e++)this.object_by_loc[t][e]=[];var i=!0,n=!1,a=void 0;try{for(var o,r=this.node.children[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var c=o.value.getComponent("Unit");if(!c.isKilled()){var s=c.loc_by_grid.y,l=c.loc_by_grid.x;this.object_by_loc[s][l].push(c)}}}catch(t){n=!0,a=t}finally{try{!i&&r.return&&r.return()}finally{if(n)throw a}}},_updateDoubleObjectByLocation:function(){for(var t=0;t<2*this.row_num-1;t++)for(var e=0;e<2*this.col_num-1;e++)this._double_object_by_loc[t][e]=[];var i=!0,n=!1,a=void 0;try{for(var o,r=this.node.children[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var c=o.value.getComponent("Unit");if(!c.isKilled()){var s=2*c.loc_by_grid.y,l=2*c.loc_by_grid.x;this._double_object_by_loc[s][l].push(c)}}}catch(t){n=!0,a=t}finally{try{!i&&r.return&&r.return()}finally{if(n)throw a}}},_getUnitAdvantage:function(){return[[0,0,0,0,0,0],[1,1,1.2,.8,1.2,1.2],[1,.8,1,1.2,1.2,1.2],[1,1.2,.8,1,1.2,1.2],[.4,.4,.4,.6,1.5,1.5],[1,1,1,.8,.6,.6]]},_isFightingHappend:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(null!==t)return 2===new Set(t.map(function(t){return t.camp})).size;this._updateDoubleObjectByLocation();for(var e=0;e<2*this.row_num-1;e++)for(var i=0;i<2*this.col_num-1;i++){var n=this._double_object_by_loc[e][i];if(2===new Set(n.map(function(t){return t.camp})).size)return!0}return!1},isSelectUnit:function(t){var e=t.y,i=t.x,n=this.object_by_loc[e][i][0];return!(!n||n.mask.active)},_eventSelectUnit:function(t){var e=this.father.order;null!==e.last_selected_flag&&e.cancelSelectFlag();var i=this.object_by_loc[t.y][t.x][0];null!==this.last_selected_unit?this.last_selected_unit===i?this.cancelSelectUnit():(this.cancelSelectUnit(),this._selectUnit(i)):this._selectUnit(i)},_selectUnit:function(t){var e=this.father.mark;e.showMoveRangeMark(t),e.showAttackRangeMark(t),t.showAttackRangeHurt(),this.last_selected_unit=t;var i=this.father.father.message;i.updateState(this.last_selected_unit),i.updateMessage(this.last_selected_unit)},cancelSelectUnit:function(){var t=this.father.mark;t.hideMoveRangeMark(this.last_selected_unit),t.hideAttackRangeMark(this.last_selected_unit),this.last_selected_unit.hideAttackRangeHurt(),this.last_selected_unit=null;var e=this.father.father.message;e.updateState(this.last_selected_unit),e.updateMessage(this.last_selected_unit)},setRedUnitMoveTarget:function(){var t=[],e=[],i=!0,n=!1,a=void 0;try{for(var o,r=this.node.children[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var c=o.value.getComponent("Unit");0===c.camp?t.push(c):1===c.camp&&e.push(c)}}catch(t){n=!0,a=t}finally{try{!i&&r.return&&r.return()}finally{if(n)throw a}}t.sort(function(t,e){return t.HP-e.HP});var s=!0,l=!1,h=void 0;try{for(var _,d=e[Symbol.iterator]();!(s=(_=d.next()).done);s=!0){_.value.setMoveTargetMethodOne(t)}}catch(t){l=!0,h=t}finally{try{!s&&d.return&&d.return()}finally{if(l)throw h}}},setAllUnitAttackTarget:function(){var t=!0,e=!1,i=void 0;try{for(var n,a=this.node.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){n.value.getComponent("Unit").setAttackTargetMethodOne()}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}},clearAllUnitCommand:function(){var t=!0,e=!1,i=void 0;try{for(var n,a=this.node.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){n.value.getComponent("Unit").clearCommand()}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}},setAllUnitCommand:function(){var t=!0,e=!1,i=void 0;try{for(var n,a=this.node.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){n.value.getComponent("Unit").setCommand()}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}},redUnitEnterBattle:function(){var t=this.father.father.menu.red_barracks.children.map(function(t){return t.getComponent("Unit")}),e=!0,i=!1,n=void 0;try{for(var a,o=t[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){a.value.enterBattleMethodRandom()}}catch(t){i=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw n}}},blueGeneralEnterBattle:function(){var t=this.father.father.menu,e=t.blue_barracks.children.map(function(t){return t.getComponent("Unit")}),i=!0,n=!1,a=void 0;try{for(var o,r=e[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var c=o.value;0===c.id&&c.enterBattleMethodRandom()}}catch(t){n=!0,a=t}finally{try{!i&&r.return&&r.return()}finally{if(n)throw a}}for(var s=t.blue_barracks.children,l=0;l<s.length;l++)cc.tween(s[l]).to(.5,{x:{value:30+50*l,easing:"cubicOut"}}).start()},allUnitEnterBarracks:function(){var t=this.node.children.map(function(t){return t.getComponent("Unit")}),e=!0,i=!1,n=void 0;try{for(var a,o=t[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){a.value.enterBarracks()}}catch(t){i=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw n}}},clearAllUnitAction:function(){var t=!0,e=!1,i=void 0;try{for(var n,a=this.node.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){n.value.getComponent("Unit").clearAction()}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}},setRedUnitOrderAction:function(){var t=[],e=!0,i=!1,n=void 0;try{for(var a,o=this.node.children[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){1===(v=a.value.getComponent("Unit")).camp&&t.push(v)}}catch(t){i=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw n}}var r=!0,c=!1,s=void 0;try{for(var l,h=this.node.children[Symbol.iterator]();!(r=(l=h.next()).done);r=!0){0===(v=l.value.getComponent("Unit")).camp&&0===v.id&&t.push(v)}}catch(t){c=!0,s=t}finally{try{!r&&h.return&&h.return()}finally{if(c)throw s}}var _=!0,d=!1,u=void 0;try{for(var f,y=t[Symbol.iterator]();!(_=(f=y.next()).done);_=!0){var v;(v=f.value).setOrderAction();var m=new Set([].concat(t));m.delete(v),m=Array.from(m),v.setOtherUnitDelayAction(v,m)}}catch(t){d=!0,u=t}finally{try{!_&&y.return&&y.return()}finally{if(d)throw u}}},_setAllUnitHideMaskAction:function(){var t=!0,e=!1,i=void 0;try{for(var n,a=this.node.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){n.value.getComponent("Unit").setHideMaskAction()}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}},setAllUnitMoraleUpDownAction:function(){var t=this.father.father.text._day_num,e=[],i=!1,n=[],a=!1,o=!0,r=!1,c=void 0;try{for(var s,l=this.node.children[Symbol.iterator]();!(o=(s=l.next()).done);o=!0){0===(y=s.value.getComponent("Unit")).camp?(e.push(y),0===y.id&&(i=!0)):(n.push(y),0===y.id&&(a=!0))}}catch(t){r=!0,c=t}finally{try{!o&&l.return&&l.return()}finally{if(r)throw c}}if(a&&t%5==1){var h=!0,_=!1,d=void 0;try{for(var u,f=n[Symbol.iterator]();!(h=(u=f.next()).done);h=!0){var y;(y=u.value).setMoraleUpDownAction(10)}}catch(t){_=!0,d=t}finally{try{!h&&f.return&&f.return()}finally{if(_)throw d}}}else{var v=!0,m=!1,g=void 0;try{for(var p,b=n[Symbol.iterator]();!(v=(p=b.next()).done);v=!0){p.value.setMoraleUpDownAction(-5)}}catch(t){m=!0,g=t}finally{try{!v&&b.return&&b.return()}finally{if(m)throw g}}}if(i&&t%5==1){var x=!0,A=!1,w=void 0;try{for(var k,M=e[Symbol.iterator]();!(x=(k=M.next()).done);x=!0){k.value.setMoraleUpDownAction(10)}}catch(t){A=!0,w=t}finally{try{!x&&M.return&&M.return()}finally{if(A)throw w}}}else{var S=!0,C=!1,U=void 0;try{for(var H,P=e[Symbol.iterator]();!(S=(H=P.next()).done);S=!0){H.value.setMoraleUpDownAction(-5)}}catch(t){C=!0,U=t}finally{try{!S&&P.return&&P.return()}finally{if(C)throw U}}}},setAllUnitMoveAction:function(){this._setAllUnitHideMaskAction();for(var t=!1;!t;){t=!0;for(var e=0;e<2*this.row_num-1;e++)for(var i=0;i<2*this.col_num-1;i++){var n=this._double_object_by_loc[e][i],a=!0,o=!1,r=void 0;try{for(var c,s=n[Symbol.iterator]();!(a=(c=s.next()).done);a=!0){t&=c.value.setMoveStepAction()}}catch(t){o=!0,r=t}finally{try{!a&&s.return&&s.return()}finally{if(o)throw r}}}if(this._isFightingHappend()){for(var l=0;l<2*this.row_num-1;l++)for(var h=0;h<2*this.col_num-1;h++){var _=this._double_object_by_loc[l][h];if(this._isFightingHappend(_)){var d=0,u=0,f=!0,y=!1,v=void 0;try{for(var m,g=_[Symbol.iterator]();!(f=(m=g.next()).done);f=!0){var p=m.value;0===p.camp?u+=p.HP:d+=p.HP}}catch(t){y=!0,v=t}finally{try{!f&&g.return&&g.return()}finally{if(y)throw v}}var b=Math.min(d,u),x=b,A=b,w=_.sort(function(t,e){return t.HP-e.HP}),k=!0,M=!1,S=void 0;try{for(var C,U=w[Symbol.iterator]();!(k=(C=U.next()).done);k=!0){var H=C.value,P=void 0;0===H.camp?(P=H.HP-Math.min(H.HP,A),A-=Math.min(H.HP,A)):(P=H.HP-Math.min(H.HP,x),x-=Math.min(H.HP,x)),H.setEncounterFightAction(P,-b)}}catch(t){M=!0,S=t}finally{try{!k&&U.return&&U.return()}finally{if(M)throw S}}}else{var O=!0,R=!1,D=void 0;try{for(var B,F=_[Symbol.iterator]();!(O=(B=F.next()).done);O=!0){B.value.setEncounterDelayAction()}}catch(t){R=!0,D=t}finally{try{!O&&F.return&&F.return()}finally{if(R)throw D}}}}this._updateDoubleObjectByLocation()}}this.updateObjectByLocation(),this.father.father.head.updateMiniMapUnit()},_setAllUnitHideHPAction:function(){var t=!0,e=!1,i=void 0;try{for(var n,a=this.node.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){n.value.getComponent("Unit").setHideHPAction()}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}},_setAllUnitHideMoraleAction:function(){var t=!0,e=!1,i=void 0;try{for(var n,a=this.node.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){n.value.getComponent("Unit").setHideMoraleAction()}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}},setAllUnitFightAction:function(){this._setAllUnitHideHPAction(),this._setAllUnitHideMoraleAction();var t=this.node.children.map(function(t){return t.getComponent("Unit")}),e=!0,i=!1,a=void 0;try{for(var o,r=t[Symbol.iterator]();!(e=(o=r.next()).done);e=!0){var c=o.value;if(c.atk_tag.length>0){c.setFightAction();var s=new Set([].concat(n(t)));s.delete(c);var l=!0,h=!1,_=void 0;try{for(var d,u=c.atk_tag[Symbol.iterator]();!(l=(d=u.next()).done);l=!0){var f=d.value;s.delete(f)}}catch(t){h=!0,_=t}finally{try{!l&&u.return&&u.return()}finally{if(h)throw _}}s=Array.from(s),c.setOtherUnitDelayAction(c,s)}}}catch(t){i=!0,a=t}finally{try{!e&&r.return&&r.return()}finally{if(i)throw a}}},setAllUnitRoundOverAction:function(){var t=!0,e=!1,i=void 0;try{for(var n,a=this.node.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){n.value.getComponent("Unit").setRoundOverAction()}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}},runAllUnitAction:function(){var t=!0,e=!1,i=void 0;try{for(var n,a=this.node.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){n.value.getComponent("Unit").startAction()}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}}}),cc._RF.pop()},{}],Battle:[function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}cc._RF.push(e,"fc87eaNQNlCOLBoo2lJ3dKi","Battle"),cc.Class({extends:cc.Component,properties:{select_audio:{default:null,type:cc.AudioClip}},onLoad:function(){this.father=cc.find("scene1").getComponent("Scene1"),this._genArray=this.father._genArray,this.map=cc.find("map",this.node).getComponent("Map"),this.mark=cc.find("move range",this.node).getComponent("Mark"),this.army=cc.find("army",this.node).getComponent("Army"),this.order=cc.find("order",this.node).getComponent("Order"),this.selected=cc.find("selected",this.node),this.location={x:0,min_x:-120,max_x:120,y:0,min_y:-132,max_y:132},this.row_num=17,this.col_num=13,this.node.on("touchstart",this._eventTouchStart,this),this.node.on("touchmove",this._eventTouchMove,this),this.node.on("touchend",this._eventTouchEnd,this),this.node.on("red unit embattle",this._eventRedUnitEmbattle,this),this.node.on("blue unit embattle",this._eventBlueUnitEmbattle,this),this.node.on("wait round begin",this._eventWaitRoundBegin,this),this.node.on("round begin",this._eventRoundBegin,this),this.node.on("red unit order",this._eventRedUnitOrder,this),this.node.on("blue unit order",this._eventBlueUnitOrder,this),this.node.on("unit move",this._eventUnitMove,this),this.node.on("unit fight",this._eventUnitFight,this),this.node.on("round over",this._eventRoundOver,this),this.node.on("game over",this._eventGameOver,this),this._select_event_paused=!1},onEnable:function(){},start:function(){},update:function(t){},lateUpdate:function(t){},onDisable:function(){},beforeDestroy:function(){},onDestroy:function(){},_eventTouchStart:function(){this.location.x=this.node.x,this.location.y=this.node.y},_eventTouchMove:function(t){var e=t.getStartLocation(),i=t.getLocation(),n=this.location.x-10*Math.floor((e.x-i.x)/10);this.node.x=Math.max(this.location.min_x,Math.min(this.location.max_x,n));var a=this.location.y-10*Math.floor((e.y-i.y)/10);this.node.y=Math.max(this.location.min_y,Math.min(this.location.max_y,a))},_eventTouchEnd:function(t){if(!this._select_event_paused){var e=t.getStartLocation(),i=t.getLocation();this._getDistance(e,i)<10&&this._select(e)}},_select:function(t){cc.audioEngine.play(this.select_audio,!1);var e=this._getLocationByGrid(t);this.selected.x=-this.node.width/2+24+48*e.x,this.selected.y=this.node.height/2-24-48*e.y,this.father.head.updateMiniMapSelected(),this.father.menu.cancelSelectHelp(),this.army.isSelectUnit(e)?this.army.node.emit("select unit",e):this.mark.isSelectBlueArea(e)?this.mark.node.emit("select blue area",e):this.order.isSelectFlag(e)?this.order.node.emit("select flag",e):this.mark.isSelectMoveRangeMark(e)?this.mark.node.emit("select move range mark",e):this.map.node.emit("select land",e)},_eventRedUnitEmbattle:function(){this.node.emit("blue unit embattle")},_eventBlueUnitEmbattle:function(){this.army.blueGeneralEnterBattle(),this.resumeSelectEvents()},_eventWaitRoundBegin:function(){this.father.head.updateRedBlueCompare(),this.army.clearAllUnitAction(),this.army.setAllUnitMoraleUpDownAction(),this.army.runAllUnitAction(),this._waitMoraleUpDownActionOver()},_eventRoundBegin:function(){this.army.clearAllUnitCommand(),this.father.text.activeRedOrderText()},_eventRedUnitOrder:function(){this.army.clearAllUnitAction(),this.army.setRedUnitOrderAction(),this.army.runAllUnitAction(),this._waitRedUnitOrderActionOver()},_eventBlueUnitOrder:function(){this.father.menu.enableFinishOrder(),this.resumeSelectEvents()},_eventUnitMove:function(){this.army.setRedUnitMoveTarget(),this.army.clearAllUnitAction(),this.army.setAllUnitMoveAction(),this.army.runAllUnitAction(),this._waitAllUnitMoveActionOver()},_eventUnitFight:function(){this.army.setAllUnitAttackTarget(),this.army.clearAllUnitAction(),this.army.setAllUnitFightAction(),this.army.runAllUnitAction(),this._waitAllUnitFightActionOver()},_eventRoundOver:function(){this.army.clearAllUnitAction(),this.army.setAllUnitRoundOverAction(),this.army.runAllUnitAction(),this._waitAllUnitRoundOverActionOver()},_eventGameOver:function(){this.army.allUnitEnterBarracks();var t=this.father.menu;t.showMenuThree(),t.enableNewGame()},_getDistance:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},_getLocationByGrid:function(t){var e=this.father.window1,i=this.father.node.x+e.x+this.node.x-this.node.width/2,n=this.father.node.y+e.y+this.node.y+this.node.height/2,a=Math.floor((n-t.y)/48),o=Math.floor((t.x-i)/48);return new cc.Vec2(o,a)},_waitMoraleUpDownActionOver:function(){var t=this.army.node.children.map(function(t){return t.getComponent("Unit").getActionDuration()}),e=Math.max.apply(Math,n(t))+.3,i=(this.father.text,this.father.menu);cc.tween(this.node).delay(e).call(function(){i.enableRoundBegin(),this.resumeSelectEvents()},this).start()},_waitRedUnitOrderActionOver:function(){var t=this.army.node.children.map(function(t){return t.getComponent("Unit").getActionDuration()}),e=Math.max.apply(Math,n(t))+.3,i=this.father.text;cc.tween(this.node).delay(e).call(function(){i.activeBlueOrderText()},this).start()},_waitAllUnitMoveActionOver:function(){var t=this.army.node.children.map(function(t){return t.getComponent("Unit").getActionDuration()}),e=Math.max.apply(Math,n(t))+.3,i=this.father.text,a=this.father.head;cc.tween(this.node).delay(e).call(function(){a.updateRedBlueCompare()},this).call(function(){i.activeFightText()},this).start()},_waitAllUnitFightActionOver:function(){var t=this.army.node.children.map(function(t){return t.getComponent("Unit").getActionDuration()}),e=Math.max.apply(Math,n(t))+.3,i=this.father.text,a=this.father.head;cc.tween(this.node).delay(e).call(function(){a.updateRedBlueCompare()},this).call(function(){i.activeRoundOverText()},this).start()},_isGameOver:function(){var t=0,e=0,i=!1,n=!1,a=!0,o=!1,r=void 0;try{for(var c,s=this.army.node.children[Symbol.iterator]();!(a=(c=s.next()).done);a=!0){var l=c.value.getComponent("Unit");0===l.camp?(e+=1,0===l.id&&(n=!0)):(t+=1,0===l.id&&(i=!0))}}catch(t){o=!0,r=t}finally{try{!a&&s.return&&s.return()}finally{if(o)throw r}}return 0===t||0===e||(!(1!==t||!i)||!(1!==e||!n))},_waitAllUnitRoundOverActionOver:function(){var t=this.army.node.children.map(function(t){return t.getComponent("Unit").getActionDuration()}),e=Math.max.apply(Math,n(t))+.3,i=this.father.text,a=this.father.head;cc.tween(this.node).delay(e).call(function(){a.updateRedBlueCompare()},this).call(function(){this._isGameOver()?i.activeGameOverText():i.activeDayText()},this).start()},pauseSelectEvents:function(){this._select_event_paused=!0},resumeSelectEvents:function(){this._select_event_paused=!1},moveCamera:function(t){var e=0+48*((this.col_num-1)/2-t.x),i=0-48*((this.row_num-1)/2-t.y);this.node.x=Math.max(this.location.min_x,Math.min(this.location.max_x,e)),this.node.y=Math.max(this.location.min_y,Math.min(this.location.max_y,i))},moveSelected:function(t){this.selected.x=-this.node.width/2+24+48*t.x,this.selected.y=this.node.height/2-24-48*t.y}}),cc._RF.pop()},{}],Fight_Anim:[function(t,e,i){"use strict";cc._RF.push(e,"a53a6yw+stC7oQWX6QDQKTO","Fight_Anim"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.node.setPosition(this.position),this.fight=cc.find("fight",this.node),this.red=cc.find("red",this.node),this.red.getComponent(cc.Label).string=this.red_loss,this.blue=cc.find("blue",this.node),this.blue.getComponent(cc.Label).string=this.blue_loss,this.tween1=cc.tween(this.fight).delay(.8).to(.2,{opacity:0}),this.tween2=cc.tween(this.red).delay(.8).call(function(){this.red.active=!0},this).to(.4,{opacity:0}),this.tween3=cc.tween(this.blue).delay(.8).call(function(){this.blue.active=!0},this).to(.4,{opacity:0}),this.tween4=cc.tween(this.node).delay(1.3).call(function(){this.node.destroy()},this)},onEnable:function(){},start:function(){},update:function(t){},lateUpdate:function(t){},onDisable:function(){},beforeDestroy:function(){},onDestroy:function(){},runAction:function(){this.node.active=!0,this.tween1.start(),this.tween2.start(),this.tween3.start(),this.tween4.start()}}),cc._RF.pop()},{}],Fight:[function(t,e,i){"use strict";cc._RF.push(e,"53e718zOBhEurxoZFJx9ZT7","Fight"),cc.Class({extends:cc.Component,properties:{fight_anim_prefab:{default:null,type:cc.Prefab}},onLoad:function(){this.father=cc.find("scene1/battle").getComponent("Battle"),this._genArray=this.father._genArray,this.tiled_tile=cc.find("fight/tiled tile",this.node).getComponent(cc.TiledTile),this.row_num=17,this.col_num=13,this.object_by_loc=this.initObjectByLocation(),this.node.on("select flag",this.eventSelectFlag,this)},onEnable:function(){},start:function(){},update:function(t){},lateUpdate:function(t){},onDisable:function(){},beforeDestroy:function(){},onDestroy:function(){},initObjectByLocation:function(){for(var t=this._genArray(this.row_num,this.col_num),e=0;e<this.row_num;e++)for(var i=0;i<this.col_num;i++)t[e][i]={gid:5,linked_unit:null};return t},isSelectFlag:function(t){return 1===this.object_by_loc[t.y][t.x].gid},eventSelectFlag:function(t){var e=this.father.army,i=this.object_by_loc[t.y][t.x];e.node.emit("select unit",i.linked_unit.loc_by_grid)},setFlag:function(t,e){var i=t.y,n=t.x,a=this.object_by_loc[i][n];a.gid=e.camp+1,a.linked_unit=e,this._setTileGIDAt(n,i,a.gid)},removeFlag:function(t){var e=t.y,i=t.x,n=this.object_by_loc[e][i];n.gid=5,n.linked_unit=null,this._setTileGIDAt(i,e,n.gid)},generateFightAnimation:function(t,e,i){var n=cc.instantiate(this.fight_anim_prefab).getComponent("Fight_Anim");return n.position=new cc.Vec2(-this.node.width/2+24+48*t.x,this.node.height/2-24-48*t.y),n.red_loss=e,n.blue_loss=i,cc.log(n.node),this.node.addChild(n.node),n},_setTileGIDAt:function(t,e,i){this.tiled_tile.x=t,this.tiled_tile.y=e,this.tiled_tile.gid=i}}),cc._RF.pop()},{}],Head:[function(t,e,i){"use strict";cc._RF.push(e,"7a9caZ7uiNDWJGjHr9/Pjl3","Head"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.father=cc.find("scene1").getComponent("Scene1"),this.day_label=cc.find("day",this.node).getComponent(cc.Label),this.comp_red=cc.find("compare/red mask",this.node),this.comp_blue=cc.find("compare/blue mask",this.node),this.mini_map=cc.find("mini map",this.node),this.tiled_tile=cc.find("mini map/mini map/tiled tile",this.mini_map).getComponent(cc.TiledTile),this.selected=cc.find("selected",this.mini_map),this.open_map=cc.find("open map",this.node),this.open_map.on("touchstart",this._eventChangeMapDisplay,this)},onEnable:function(){},start:function(){},update:function(t){},lateUpdate:function(t){},onDisable:function(){},beforeDestroy:function(){},onDestroy:function(){},_eventChangeMapDisplay:function(){!0===this.mini_map.active?this.mini_map.active=!1:(this.mini_map.active=!0,this.updateMiniMapSelected(),this.updateMiniMapUnit())},_setTileGIDAt:function(t,e,i){this.tiled_tile.x=t,this.tiled_tile.y=e,this.tiled_tile.gid=i},updateDay:function(t){this.day_label.string="DAY "+t},updateRedBlueCompare:function(){var t=0,e=0,i=this.father.battle.army,n=!0,a=!1,o=void 0;try{for(var r,c=i.node.children[Symbol.iterator]();!(n=(r=c.next()).done);n=!0){var s=r.value.getComponent("Unit");e+=s.HP,1===s.camp&&(t+=s.HP)}}catch(t){a=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}this.comp_red.width=21+Math.round(t/e*200),this.comp_blue.width=242-this.comp_red.width},updateMiniMapSelected:function(){if(!0===this.mini_map.active){var t=this.father.battle.selected;this.selected.x=t.x,this.selected.y=t.y}},updateMiniMapUnit:function(){if(!0===this.mini_map.active)for(var t=this.father.battle.army.object_by_loc,e=t.length,i=t[0].length,n=0;n<e;n++)for(var a=0;a<i;a++){var o=t[n][a][0];o?this._setTileGIDAt(a,n,11-o.camp):this._setTileGIDAt(a,n,9)}}}),cc._RF.pop()},{}],Map:[function(t,e,i){"use strict";cc._RF.push(e,"b4b84T16xBPf7gw1kXDlWec","Map"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.father=cc.find("scene1/window1/battle").getComponent("Battle"),this.node.on("select land",this._eventSelectLand,this)},onEnable:function(){},start:function(){},update:function(t){},lateUpdate:function(t){},onDisable:function(){},beforeDestroy:function(){},onDestroy:function(){},_eventSelectLand:function(t){var e=this.father.army;null!==e.last_selected_unit&&e.cancelSelectUnit();var i=this.father.order;null!==i.last_selected_flag&&i.cancelSelectFlag()}}),cc._RF.pop()},{}],Mark:[function(t,e,i){"use strict";cc._RF.push(e,"2c735CG42dAIp9tN+H+rpt8","Mark"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.father=cc.find("scene1/window1/battle").getComponent("Battle"),this._genArray=this.father._genArray,this.move_range=cc.find("move range",this.father.node),this.attack_range=cc.find("attack range",this.father.node),this.place_range=cc.find("place range",this.father.node),this.mov_range_mark=this._genArray(2,10);var t=!0,e=!1,i=void 0;try{for(var n,a=this.move_range.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){var o=(d=n.value.getComponent(cc.TiledLayer))._properties.camp,r=d._properties.mov;this.mov_range_mark[o][r]=d}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}this.actived_mov_range_mark=null,this.atk_range_mark=this._genArray(1,10);var c=!0,s=!1,l=void 0;try{for(var h,_=this.attack_range.children[Symbol.iterator]();!(c=(h=_.next()).done);c=!0){var d;o=(d=h.value.getComponent(cc.TiledLayer))._properties.atk;this.atk_range_mark[o]=d}}catch(t){s=!0,l=t}finally{try{!c&&_.return&&_.return()}finally{if(s)throw l}}this.actived_atk_range_mark=null,this.red_area=cc.find("red area",this.place_range),this.black_area=cc.find("black area",this.place_range),this.blue_area=cc.find("blue area",this.place_range),this.blue_area_tiled_layer=this.blue_area.getComponent(cc.TiledLayer),this.node.on("select move range mark",this._eventSelectMoveRangeMark,this),this.node.on("select blue area",this._eventSelectBlueArea,this)},onEnable:function(){},start:function(){},update:function(t){},lateUpdate:function(t){},onDisable:function(){},beforeDestroy:function(){},onDestroy:function(){},_eventSelectMoveRangeMark:function(t){var e=this.father.army,i=this.father.order,n=this.father.father.menu;e.last_selected_unit.playMoveAudio(),e.last_selected_unit.setTargetLocation(t),e.last_selected_unit.setCommand(),e.last_selected_unit.setMask(),i.setFlag(t,e.last_selected_unit),n.pushOrder(e.last_selected_unit),e.cancelSelectUnit()},isSelectMoveRangeMark:function(t){var e=this.father.army;if(e.last_selected_unit&&!0!==e.last_selected_unit.isCommandOver()){var i=e.last_selected_unit.getMoveRange(),n=!0,a=!1,o=void 0;try{for(var r,c=i[Symbol.iterator]();!(n=(r=c.next()).done);n=!0){var s=r.value;if(s.x===t.x&&s.y===t.y)return!0}}catch(t){a=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}}return!1},_eventSelectBlueArea:function(t){this.hideBlueArea(),this.father.father.menu.enterBattleOnce(t)},isSelectBlueArea:function(t){var e=this.father.father.menu;if(e.last_selected_unit){var i=e.last_selected_unit.getPlaceRange(),n=!0,a=!1,o=void 0;try{for(var r,c=i[Symbol.iterator]();!(n=(r=c.next()).done);n=!0){var s=r.value;if(s.x===t.x&&s.y===t.y)return!0}}catch(t){a=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}}return!1},showMoveRangeMark:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.mov_range_mark[t.camp][t.mov];null!==e?(i.node.x=t.node.x+48*(e.x-t.loc_by_grid.x),i.node.y=t.node.y-48*(e.y-t.loc_by_grid.y)):(i.node.x=t.node.x,i.node.y=t.node.y),i.node.active=!0,this.actived_mov_range_mark=i},hideMoveRangeMark:function(t){this.mov_range_mark[t.camp][t.mov].node.active=!1,this.actived_mov_range_mark=null},showAttackRangeMark:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=this.atk_range_mark[t.atk];null!==e?(i.node.x=t.node.x+48*(e.x-t.loc_by_grid.x),i.node.y=t.node.y-48*(e.y-t.loc_by_grid.y)):(i.node.x=t.node.x,i.node.y=t.node.y),i.node.active=!0,this.actived_atk_range_mark=i},hideAttackRangeMark:function(t){this.atk_range_mark[t.atk].node.active=!1,this.actived_atk_range_mark=null},showBlueArea:function(){var t=this.father.father.menu.last_selected_unit.place;this.blue_area.y=96*(3-t),this.blue_area.active=!0},hideBlueArea:function(){this.blue_area.active=!1},showPlaceArea:function(){this.red_area.active=!0,this.black_area.active=!0},hidePlaceArea:function(){this.red_area.active=!1,this.black_area.active=!1,this.blue_area.active=!1}}),cc._RF.pop()},{}],Menu:[function(t,e,i){"use strict";cc._RF.push(e,"8b46dENdU1PS7mn8Cs4ujE5","Menu"),cc.Class({extends:cc.Component,properties:{select_audio:{default:null,type:cc.AudioClip},back_audio:{default:null,type:cc.AudioClip}},onLoad:function(){this.father=cc.find("scene1").getComponent("Scene1"),this.enable_color=new cc.Color(221,216,92,255),this.disable_color=new cc.Color(94,87,87,255),this._order_list=[],this._embattle_list=[],this.last_selected_unit=null,this.red_barracks=cc.find("red barracks",this.node),this.blue_barracks=cc.find("blue barracks",this.node),this.back_embattle=cc.find("back embattle",this.node),this._is_back_embattle_active=!1,this.back_embattle.on("touchstart",this._eventSelectBackEmbattle,this),this.finish_embattle=cc.find("finish embattle",this.node),this._is_finish_embattle_active=!1,this.finish_embattle.on("touchstart",this._eventSelectFinishEmbattle,this),this.help=cc.find("help",this.node),this.help.on("touchstart",this._eventSelectHelp,this),this.round_begin=cc.find("round begin",this.node),this._is_round_begin_active=!0,this.round_begin.on("touchstart",this._eventSelectRoundBegin,this),this.back_order=cc.find("back order",this.node),this._is_back_order_active=!1,this.back_order.on("touchstart",this._eventSelectBackOrder,this),this.finish_order=cc.find("finish order",this.node),this._is_finish_order_active=!1,this.finish_order.on("touchstart",this._eventSelectFinishOrder,this),this.new_game=cc.find("new game",this.node),this._is_new_game_active=!1,this.new_game.on("touchstart",this._eventSelectNewGame,this)},onEnable:function(){},start:function(){},update:function(t){},lateUpdate:function(t){},onDisable:function(){},beforeDestroy:function(){},onDestroy:function(){},_eventSelectBackEmbattle:function(){this._is_back_embattle_active&&(this._cancelSelected(),this.playBackAudio(),this.popEmbattle())},_eventSelectFinishEmbattle:function(){if(this._is_finish_embattle_active){this._cancelSelected(),this.playSelectAudio(),this._clearEmbattle(),this.disableFinishEmbattle(),this.showMenuTwo(),this.last_selected_unit&&(this.last_selected_unit.scale=1,this.last_selected_unit=null);var t=this.father.battle;t.pauseSelectEvents(),t.mark.hidePlaceArea(),t.army.redUnitEnterBattle(),this.father.text.activeDayText()}},_eventSelectHelp:function(){this._cancelSelected(),this.playSelectAudio(),this.father.introduction.active=!0},cancelSelectHelp:function(){this.father.introduction.active=!1},_eventSelectRoundBegin:function(){this._is_round_begin_active&&(this._cancelSelected(),this.playSelectAudio(),this.disableRoundBegin(),this.father.battle.pauseSelectEvents(),this.father.text.activeRoundBeginText())},_eventSelectBackOrder:function(){this._is_back_order_active&&(this._cancelSelected(),this.playBackAudio(),this.popOrder())},_eventSelectFinishOrder:function(){if(this._is_finish_order_active){this._cancelSelected(),this.playSelectAudio(),this._clearOrder(),this.disableFinishOrder();var t=this.father.battle;t.pauseSelectEvents(),t.army.setAllUnitCommand(),this.father.text.activeMoveText()}},_eventSelectNewGame:function(){if(this._is_new_game_active){this._cancelSelected(),this.playSelectAudio(),this.disableNewGame(),this.showMenuOne();var t=this.father.battle;t.mark.showPlaceArea(),t.node.setPosition(0,132),t.node.emit("red unit embattle")}},enableRoundBegin:function(){this._is_round_begin_active=!0,this.round_begin.color=this.enable_color},disableRoundBegin:function(){this._is_round_begin_active=!1,this.round_begin.color=this.disable_color},enableBackOrder:function(){this._is_back_order_active=!0;var t=!0,e=!1,i=void 0;try{for(var n,a=this.back_order.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){n.value.color=this.enable_color}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}},disableBackOrder:function(){this._is_back_order_active=!1;var t=!0,e=!1,i=void 0;try{for(var n,a=this.back_order.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){n.value.color=this.disable_color}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}},enableFinishOrder:function(){this._is_finish_order_active=!0,this.finish_order.color=this.enable_color},disableFinishOrder:function(){this._is_finish_order_active=!1,this.finish_order.color=this.disable_color},enableBackEmbattle:function(){this._is_back_embattle_active=!0;var t=!0,e=!1,i=void 0;try{for(var n,a=this.back_embattle.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){n.value.color=this.enable_color}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}},disableBackEmbattle:function(){this._is_back_embattle_active=!1;var t=!0,e=!1,i=void 0;try{for(var n,a=this.back_embattle.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){n.value.color=this.disable_color}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}},enableFinishEmbattle:function(){this._is_finish_embattle_active=!0;var t=!0,e=!1,i=void 0;try{for(var n,a=this.finish_embattle.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){n.value.color=this.enable_color}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}},disableFinishEmbattle:function(){this._is_finish_order_active=!1;var t=!0,e=!1,i=void 0;try{for(var n,a=this.finish_embattle.children[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){n.value.color=this.disable_color}}catch(t){e=!0,i=t}finally{try{!t&&a.return&&a.return()}finally{if(e)throw i}}},enableNewGame:function(){this._is_new_game_active=!0,this.new_game.color=this.enable_color},disableNewGame:function(){this._is_new_game_active=!1,this.new_game.color=this.disable_color},pushOrder:function(t){this._order_list.push(t),1===this._order_list.length&&(this._is_back_order_active=!0,this.enableBackOrder())},popOrder:function(){var t=this._order_list.pop();this.father.battle.order.removeFlag(t._tag_loc_by_grid,t),t.setTargetLocation(t.loc_by_grid),t.clearCommand(),t.hideMask(),0===this._order_list.length&&(this._is_back_order_active=!1,this.disableBackOrder())},_clearOrder:function(){this._order_list=[],this._is_back_order_active=!1,this.disableBackOrder()},pushEmbattle:function(t){this._embattle_list.push(t),0===this.blue_barracks.children.length&&this.enableFinishEmbattle(),1===this._embattle_list.length&&(this._is_back_embattle_active=!0,this.enableBackEmbattle())},popEmbattle:function(){this._embattle_list.pop().enterBarracks(),this.disableFinishEmbattle(),0===this._embattle_list.length&&(this._is_back_embattle_active=!1,this.disableBackEmbattle())},_clearEmbattle:function(){this._embattle_list=[],this._is_back_embattle_active=!1,this.disableBackEmbattle()},enterBattleOnce:function(t){this.last_selected_unit.enterBattle(t),this.pushEmbattle(this.last_selected_unit),this.last_selected_unit=null;for(var e=this.blue_barracks.children,i=0;i<e.length;i++)cc.tween(e[i]).to(.5,{x:{value:30+50*i,easing:"cubicOut"}}).start()},showMenuOne:function(){this.node.x=-192,this.help.x=354},showMenuTwo:function(){this.node.x=-576,this.help.x=414},showMenuThree:function(){this.node.x=-960,this.help.x=798},_cancelSelected:function(){var t=this.father.battle.army;null!==t.last_selected_unit&&t.cancelSelectUnit();var e=this.father.battle.order;null!==e.last_selected_flag&&e.cancelSelectFlag()},playBackAudio:function(){cc.audioEngine.play(this.back_audio,!1)},playSelectAudio:function(){cc.audioEngine.play(this.select_audio,!1)}}),cc._RF.pop()},{}],Message:[function(t,e,i){"use strict";cc._RF.push(e,"06e71Mk4UNNV5mb4Zt3QTw9","Message"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.state_tag=cc.find("state tag",this.node),this.state_label=cc.find("state",this.node).getComponent(cc.Label),this.msg_list=cc.find("msg",this.node).children,this.actived_msg_id=null,this.state_list=[{name:"\u4e3b\u5e05",mov:0,atk:"\u4e0d\u53ef"},{name:"\u6b65\u5175",mov:1,atk:"\u8fd1\u6218"},{name:"\u5f13\u5175",mov:3,atk:"\u4e2d\u7a0b"},{name:"\u9a91\u5175",mov:1,atk:"\u8fd1\u6218"},{name:"\u6295\u77f3\u8f66",mov:1,atk:"\u8fdc\u7a0b"},{name:"\u5f29\u8f66",mov:1,atk:"\u8fdc\u7a0b"}]},onEnable:function(){},start:function(){},update:function(t){},lateUpdate:function(t){},onDisable:function(){},beforeDestroy:function(){},onDestroy:function(){},updateState:function(t){if(null===t)this.state_tag.active=!1,this.state_label.node.active=!1;else{this.state_tag.active=!0,this.state_label.node.active=!0;var e=this.state_list[t.id];this.state_label.string=e.name+"\n"+t.HP+"/"+t.max_HP+"\n"+t.morale+"/"+t.max_morale+"\n"+e.mov+"\n"+e.atk}},updateMessage:function(t){null===t?null!==this.actived_msg_id&&(this.msg_list[this.actived_msg_id].active=!1,this.actived_msg_id=null):(null!==this.actived_msg_id&&(this.msg_list[this.actived_msg_id].active=!1),this.actived_msg_id=t.id,this.msg_list[this.actived_msg_id].active=!0)}}),cc._RF.pop()},{}],Order:[function(t,e,i){"use strict";cc._RF.push(e,"a289fVdrJBOPLkS+RCU8Aj1","Order"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.father=cc.find("scene1/window1/battle").getComponent("Battle"),this._genArray=this.father._genArray,this.row_num=this.father.row_num,this.col_num=this.father.col_num,this.tiled_layer=cc.find("order",this.node).getComponent(cc.TiledLayer),this.tiled_tile=cc.find("order/tiled tile",this.node).getComponent(cc.TiledTile),this.object_by_loc=this._getObjectByLocation(),this.node.on("select flag",this._eventSelectFlag,this),this.last_selected_flag=null},onEnable:function(){},start:function(){},update:function(t){},lateUpdate:function(t){},onDisable:function(){},beforeDestroy:function(){},onDestroy:function(){},_getObjectByLocation:function(){for(var t=this._genArray(this.row_num,this.col_num),e=0;e<this.row_num;e++)for(var i=0;i<this.col_num;i++)t[e][i]={gid:this._getTileGIDAt(i,e),linked_unit:null};return t},_getTileGIDAt:function(t,e){return this.tiled_layer.getTileGIDAt(t,e)},_setTileGIDAt:function(t,e,i){this.tiled_tile.x=t,this.tiled_tile.y=e,this.tiled_tile.gid=i},isSelectFlag:function(t){return 1===this.object_by_loc[t.y][t.x].gid},_eventSelectFlag:function(t){var e=this.father.army;null!==e.last_selected_unit&&e.cancelSelectUnit();var i=this.object_by_loc[t.y][t.x];null!==this.last_selected_flag?this.last_selected_flag===i?this.cancelSelectFlag():(this.cancelSelectFlag(),this._selectFlag(i)):this._selectFlag(i)},_selectFlag:function(t){var e=this.father.mark,i=t.linked_unit,n=i.getTargetLocation();e.showAttackRangeMark(i,n),i.showAttackRangeHurt(n),this.last_selected_flag=t},cancelSelectFlag:function(){var t=this.father.mark,e=this.last_selected_flag.linked_unit,i=e.getTargetLocation();t.hideAttackRangeMark(e),e.hideAttackRangeHurt(i),this.last_selected_flag=null},setFlag:function(t,e){var i=t.y,n=t.x,a=this.object_by_loc[i][n];1===a.gid&&1===e.camp?a.gid=4:2===a.gid&&0===e.camp?a.gid=4:a.gid=e.camp+1,a.linked_unit=e,this._setTileGIDAt(n,i,a.gid)},removeFlag:function(t,e){var i=t.y,n=t.x,a=this.object_by_loc[i][n];4===a.gid&&1===e.camp?a.gid=1:4===a.gid&&0===e.camp?a.gid=2:a.gid=5,a.linked_unit=null,this._setTileGIDAt(n,i,a.gid)}}),cc._RF.pop()},{}],Scene1:[function(t,e,i){"use strict";cc._RF.push(e,"166e3h2rC1FB7CF5+1wHFv2","Scene1"),cc.Class({extends:cc.Component,properties:{background_audio:{default:null,type:cc.AudioClip}},onLoad:function(){this.window1=cc.find("window1",this.node),this.window2=cc.find("window2",this.node),this.window3=cc.find("window3",this.node),this.battle=cc.find("window1/battle",this.node).getComponent("Battle"),this.record=cc.find("window1/record",this.node),this.head=cc.find("window1/head",this.node).getComponent("Head"),this.text=cc.find("window1/text",this.node).getComponent("Text"),this.introduction=cc.find("window1/introduction",this.node),this.menu=cc.find("window2/menu",this.node).getComponent("Menu"),this.message=cc.find("window3/message",this.node).getComponent("Message")},onEnable:function(){},start:function(){},update:function(t){},lateUpdate:function(t){},onDisable:function(){},beforeDestroy:function(){},onDestroy:function(){},_genArray:function(t,e){for(var i=[],n=1;n<=t;n++){for(var a=[],o=1;o<=e;o++)a.push(null);i.push(a)}return 1===i.length&&(i=i[0]),i}}),cc._RF.pop()},{}],Template:[function(t,e,i){"use strict";cc._RF.push(e,"beda78AHN1MfqkllpdSJcLq","Template"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){},onEnable:function(){},start:function(){},update:function(t){},lateUpdate:function(t){},onDisable:function(){},beforeDestroy:function(){},onDestroy:function(){}}),cc._RF.pop()},{}],Text:[function(t,e,i){"use strict";cc._RF.push(e,"6d8daU7RN5CLoitmUap7/N6","Text"),cc.Class({extends:cc.Component,properties:{day_audio:{default:null,type:cc.AudioClip},round_begin_audio:{default:null,type:cc.AudioClip},order_audio:{default:null,type:cc.AudioClip},move_audio:{default:null,type:cc.AudioClip},fight_audio:{default:null,type:cc.AudioClip},game_over_audio:{default:null,type:cc.AudioClip}},onLoad:function(){this.father=cc.find("scene1").getComponent("Scene1"),this.day_label=cc.find("day",this.node).getComponent(cc.Label),this.round_begin=cc.find("round begin",this.node),this.red_order=cc.find("red order",this.node),this.blue_order=cc.find("blue order",this.node),this.move=cc.find("move",this.node),this.fight=cc.find("fight",this.node),this.round_over=cc.find("round over",this.node),this.game_over=cc.find("game over",this.node),this._day_num=1},onEnable:function(){},start:function(){},update:function(t){},lateUpdate:function(t){},onDisable:function(){},beforeDestroy:function(){},onDestroy:function(){},playDayAudio:function(){cc.audioEngine.play(this.day_audio,!1,.2)},playRoundBeginAudio:function(){this.round_begin_play=cc.audioEngine.play(this.round_begin_audio,!1,.2)},pauseRoundBeginAudio:function(){cc.audioEngine.stop(this.round_begin_play)},playOrderAudio:function(){cc.audioEngine.play(this.order_audio,!1,.2)},playMoveAudio:function(){cc.audioEngine.play(this.move_audio,!1,.2)},playFightAudio:function(){cc.audioEngine.play(this.fight_audio,!1,.2)},playGameOverAudio:function(){cc.audioEngine.play(this.game_over_audio,!1,.2)},activeDayText:function(){var t=this.father.battle,e=this.father.head;this.day_label.node.scale=10,this.day_label.node.opacity=0,this._day_num+=1,this.day_label.string="\u7b2c "+this._day_num+" \u5929",e.updateDay(this._day_num),this.day_label.node.active=!0,cc.tween(this.day_label.node).call(this.playDayAudio,this).to(.7,{scale:{value:2,easing:"cubicOut"},opacity:{value:255,easing:"cubicOut"}}).delay(.5).call(function(){this.day_label.node.active=!1},this).call(function(){t.node.emit("wait round begin")},this).start()},activeRoundBeginText:function(){var t=this.father.battle;this.round_begin.scale=10,this.round_begin.opacity=0,this.round_begin.active=!0,cc.tween(this.round_begin).call(this.playRoundBeginAudio,this).to(.7,{scale:{value:2,easing:"cubicOut"},opacity:{value:255,easing:"cubicOut"}}).delay(1.5).call(function(){this.pauseRoundBeginAudio()},this).call(function(){this.round_begin.active=!1},this).call(function(){t.node.emit("round begin")},this).start()},activeRedOrderText:function(){var t=this.father.battle;this.red_order.scale=10,this.red_order.opacity=0,this.red_order.active=!0,cc.tween(this.red_order).delay(.7).call(this.playOrderAudio,this).to(.7,{scale:{value:2,easing:"cubicOut"},opacity:{value:255,easing:"cubicOut"}}).delay(.5).call(function(){this.red_order.active=!1},this).call(function(){t.node.emit("red unit order")},this).start()},activeBlueOrderText:function(){var t=this.father.battle;this.blue_order.scale=10,this.blue_order.opacity=0,this.blue_order.active=!0,cc.tween(this.blue_order).call(this.playOrderAudio,this).to(.7,{scale:{value:2,easing:"cubicOut"},opacity:{value:255,easing:"cubicOut"}}).delay(.5).call(function(){this.blue_order.active=!1},this).call(function(){t.node.emit("blue unit order")},this).start()},activeMoveText:function(){var t=this.father.battle;this.move.scale=10,this.move.opacity=0,this.move.active=!0,cc.tween(this.move).call(this.playMoveAudio,this).to(.7,{scale:{value:2,easing:"cubicOut"},opacity:{value:255,easing:"cubicOut"}}).delay(.5).call(function(){this.move.active=!1},this).call(function(){t.node.emit("unit move")},this).start()},activeFightText:function(){var t=this.father.battle;this.fight.scale=10,this.fight.opacity=0,this.fight.active=!0,cc.tween(this.fight).delay(1).call(this.playFightAudio,this).to(.7,{scale:{value:2,easing:"cubicOut"},opacity:{value:255,easing:"cubicOut"}}).delay(.5).call(function(){this.fight.active=!1},this).call(function(){t.node.emit("unit fight")},this).start()},activeRoundOverText:function(){var t=this.father.battle;this.round_over.scale=10,this.round_over.opacity=0,this.round_over.active=!0,cc.tween(this.round_over).to(.7,{scale:{value:2,easing:"cubicOut"},opacity:{value:255,easing:"cubicOut"}}).delay(.5).call(function(){this.round_over.active=!1},this).call(function(){t.node.emit("round over")},this).start()},activeGameOverText:function(){var t=this.father.battle;this._day_num=0,this.game_over.scale=10,this.game_over.opacity=0,this.game_over.active=!0,cc.tween(this.game_over).call(this.playGameOverAudio,this).to(.7,{scale:{value:2,easing:"cubicOut"},opacity:{value:255,easing:"cubicOut"}}).delay(.5).delay(4).call(function(){this.game_over.active=!1},this).call(function(){t.node.emit("game over")},this).start()}}),cc._RF.pop()},{}],Unit:[function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}cc._RF.push(e,"55f5avIAnhCvZfxdLIqK6re","Unit"),cc.Class({extends:cc.Component,properties:{id:0,camp:0,HP:3,max_HP:3,morale:80,max_morale:100,mov:1,atk:1,place:1,loc_by_grid:cc.Vec2,mov_audio:{default:null,type:cc.AudioClip},atk_audio:{default:null,type:cc.AudioClip},encounter_audio:{default:null,type:cc.AudioClip},death_audio:{default:null,type:cc.AudioClip}},onLoad:function(){this.father=cc.find("scene1/window1/battle/army").getComponent("Army"),this.row_num=this.father.row_num,this.col_num=this.father.col_num,this.img=cc.find("img",this.node),this.HP_label=cc.find("HP label",this.node).getComponent(cc.Label),this.morale_label=cc.find("morale label",this.node).getComponent(cc.Label),this.mask=cc.find("mask",this.node),this.attack=cc.find("attack",this.node),this.fighting=cc.find("fighting",this.node),this.HP_loss_label=cc.find("HP loss label",this.node).getComponent(cc.Label),this.node.on("touchstart",this._eventSelect,this),this._init(),this.node.pauseSystemEvents(),this.setLocation(this.loc_by_grid),this.setTargetLocation(this.loc_by_grid),this._can_group_attack=this._canGroupAttack()},onEnable:function(){},start:function(){this._setUsedAction()},update:function(t){},lateUpdate:function(t){},onDisable:function(){},beforeDestroy:function(){},onDestroy:function(){},_init:function(){this._action_list=cc.tween(this.node).delay(.1),this._action_duration=.1,this._updateHP(this.max_HP),this._HP_loss_cache=0,this._updateMorale(this.max_morale),this._morale_dec_cache=0,this.setCommand(),this.atk_tag=[]},_canGroupAttack:function(){return 4===this.id||5===this.id},_eventSelect:function(){var t=this.father.father.father.menu,e=this.father.father.mark,i=this.father.father.father.message;null!==t.last_selected_unit?(cc.tween(t.last_selected_unit.node).then(this._cancel_click_action).start(),t.last_selected_unit!==this?(cc.tween(this.node).then(this._click_action).start(),e.hideBlueArea(),t.last_selected_unit=this,e.showBlueArea()):(t.last_selected_unit=null,e.hideBlueArea())):(cc.tween(this.node).then(this._click_action).start(),t.last_selected_unit=this,e.showBlueArea()),i.updateState(t.last_selected_unit),i.updateMessage(t.last_selected_unit)},_getHPLoss:function(t,e){var i=this.father.unit_advantage[t.id][e.id],n=t.morale/80*i*t.HP,a=e.morale/80*e.HP,o=Math.max(.8,Math.min(1.2,n/a));return-(100*Math.ceil(.01*n*o/3))},_updateHPValue:function(t){this.HP=t},_updateHPLabel:function(){this.HP_label.string=this.HP},_updateHP:function(t){this._updateHPValue(t),this._updateHPLabel()},_updateHPLossLabel:function(t){this.HP_loss_label.string=t},_updateMoraleValue:function(t){this.morale=t},_updateMoraleLabel:function(){this.morale_label.string=this.morale},_updateMorale:function(t){this._updateMoraleValue(t),this._updateMoraleLabel()},setLocation:function(t){var e=-this.father.node.width/2+24,i=this.father.node.height/2-24;this.node.x=e+48*t.x,this.node.y=i-48*t.y,this.loc_by_grid=t},setTargetLocation:function(t){this._tag_loc_by_grid=t},getTargetLocation:function(){return this._tag_loc_by_grid},setMask:function(){this.mask.active=!0},hideMask:function(){this.mask.active=!1},setCommand:function(){this._is_command_over=!0},clearCommand:function(){this._is_command_over=!1},isCommandOver:function(){return this._is_command_over},isKilled:function(){return 0===this.HP},showAttackRangeHurt:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=this.getAttackRange(t),i=this.father.object_by_loc,n=!0,a=!1,o=void 0;try{for(var r,c=e[Symbol.iterator]();!(n=(r=c.next()).done);n=!0){var s=r.value,l=i[s.y][s.x][0];if(l&&l.camp!==this.camp){var h=this._getHPLoss(this,l);l._updateHPLossLabel(h),l.HP_loss_label.node.active=!0}}}catch(t){a=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}},hideAttackRangeHurt:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=this.getAttackRange(t),i=this.father.object_by_loc,n=!0,a=!1,o=void 0;try{for(var r,c=e[Symbol.iterator]();!(n=(r=c.next()).done);n=!0){var s=r.value,l=i[s.y][s.x][0];l&&l.camp!==this.camp&&(l.HP_loss_label.node.active=!1)}}catch(t){a=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}},getActionDuration:function(){return this._action_duration},setMoveTargetMethodRandom:function(){var t=this.father.father.order,e=this.getMoveRange(),i=this._randint(e.length);this._tag_loc_by_grid=e[i],this.setCommand(),this.loc_by_grid.x===this._tag_loc_by_grid.x&&this.loc_by_grid.y===this._tag_loc_by_grid.y||t.setFlag(this._tag_loc_by_grid,this)},setMoveTargetMethodOne:function(t){if(Math.random()<.2)this.setMoveTargetMethodRandom();else{var e=this.father.father.order,i=[],n=!0,a=!1,o=void 0;try{for(var r,c=this.getMoveRange()[Symbol.iterator]();!(n=(r=c.next()).done);n=!0){var s=r.value,l=!0,h=!1,_=void 0;try{for(var d,u=this.getAttackRange(s)[Symbol.iterator]();!(l=(d=u.next()).done);l=!0){var f=d.value;i.push({mov_tag:s,atk_tag:f})}}catch(t){h=!0,_=t}finally{try{!l&&u.return&&u.return()}finally{if(h)throw _}}}}catch(t){a=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}if(0!==i.length){var y=!1,v=!0,m=!1,g=void 0;try{for(var p,b=t[Symbol.iterator]();!(v=(p=b.next()).done);v=!0){var x=p.value,A=!0,w=!1,k=void 0;try{for(var M,S=i[Symbol.iterator]();!(A=(M=S.next()).done);A=!0){var C=M.value;if(x._tag_loc_by_grid.x===C.atk_tag.x&&x._tag_loc_by_grid.y===C.atk_tag.y){this._tag_loc_by_grid=C.mov_tag,y=!0;break}}}catch(t){w=!0,k=t}finally{try{!A&&S.return&&S.return()}finally{if(w)throw k}}}}catch(t){m=!0,g=t}finally{try{!v&&b.return&&b.return()}finally{if(m)throw g}}if(!y){var U=t[0];i.sort(function(t,e){return Math.abs(t.atk_tag.x-U._tag_loc_by_grid.x)+Math.abs(t.atk_tag.y-U._tag_loc_by_grid.y)-(Math.abs(e.atk_tag.x-U._tag_loc_by_grid.x)+Math.abs(e.atk_tag.y-U._tag_loc_by_grid.y))}),this._tag_loc_by_grid=i[0].mov_tag}this.setCommand(),this.loc_by_grid.x===this._tag_loc_by_grid.x&&this.loc_by_grid.y===this._tag_loc_by_grid.y||e.setFlag(this._tag_loc_by_grid,this)}}},setAttackTargetMethodOne:function(){var t=this.getAttackRange(),e=this.father.object_by_loc;this.atk_tag=[];var i=!0,n=!1,a=void 0;try{for(var o,r=t[Symbol.iterator]();!(i=(o=r.next()).done);i=!0){var c=o.value,s=e[c.y][c.x][0];if(s&&s.camp!==this.camp){if(this._can_group_attack){var l=c.group,h=!0,_=!1,d=void 0;try{for(var u,f=t[Symbol.iterator]();!(h=(u=f.next()).done);h=!0){var y=u.value;if(y.group===l){var v=e[y.y][y.x][0];v&&this.atk_tag.push(v)}}}catch(t){_=!0,d=t}finally{try{!h&&f.return&&f.return()}finally{if(_)throw d}}}else this.atk_tag.push(s);break}}}catch(t){n=!0,a=t}finally{try{!i&&r.return&&r.return()}finally{if(n)throw a}}},enterBattleMethodRandom:function(){var t=this.getPlaceRange(),e=this._randint(t.length);this.enterBattle(t[e])},enterBattle:function(t){this.node.scale=1,this.node.removeFromParent(!1),this.father.node.addChild(this.node),this.setLocation(t),this.setTargetLocation(t),this.father.updateObjectByLocation(),this.father.father.father.head.updateMiniMapUnit(),this.node.pauseSystemEvents()},enterBarracks:function(){var t=this.father.father.father.menu,e=0;this.node.removeFromParent(!1),0===this.camp?(t.blue_barracks.addChild(this.node),e=t.blue_barracks.children.length):(t.red_barracks.addChild(this.node),e=t.red_barracks.children.length),this.father.updateObjectByLocation(),this.father.father.father.head.updateMiniMapUnit(),this._init(),this.node.x=30+50*(e-1),this.node.y=0,this.node.scale=.8,this.node.resumeSystemEvents()},playMoveAudio:function(){cc.audioEngine.play(this.mov_audio,!1,.5)},playAttackAudio:function(){cc.audioEngine.play(this.atk_audio,!1,.5)},playEncounterAudio:function(){cc.audioEngine.play(this.encounter_audio,!1,.5)},playDeathAudio:function(){cc.audioEngine.play(this.death_audio,!1,.5)},getMoveRange:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===t&&(t=this.loc_by_grid);var e=void 0,i=t.x,n=t.y;e=0===this.mov?new Set:1===this.mov?new Set([{x:i,y:n+1},{x:i-1,y:n},{x:i+1,y:n},{x:i,y:n-1}]):2===this.mov?new Set([{x:i,y:n+1},{x:i,y:n+2},{x:i-1,y:n},{x:i-2,y:n},{x:i+1,y:n},{x:i+2,y:n},{x:i,y:n-1},{x:i,y:n-2}]):3===this.mov?new Set([{x:i,y:n+1},{x:i,y:n+2},{x:i,y:n+3},{x:i-1,y:n},{x:i-2,y:n},{x:i-3,y:n},{x:i+1,y:n},{x:i+2,y:n},{x:i+3,y:n},{x:i,y:n-1},{x:i,y:n-2},{x:i,y:n-3}]):new Set,e=Array.from(e),0===this.camp&&e.reverse(),e.push({x:i,y:n}),e.reverse(),e=new Set(e);var a=!0,o=!1,r=void 0;try{for(var c,s=e[Symbol.iterator]();!(a=(c=s.next()).done);a=!0){var l=c.value;(l.x<0||l.x>this.col_num-1||l.y<0||l.y>this.row_num-1)&&e.delete(l)}}catch(t){o=!0,r=t}finally{try{!a&&s.return&&s.return()}finally{if(o)throw r}}var h=[],_=this.father,d=!0,u=!1,f=void 0;try{for(var y,v=_.node.children[Symbol.iterator]();!(d=(y=v.next()).done);d=!0){var m=y.value.getComponent("Unit");m.camp===this.camp&&m!==this&&h.push(m.getTargetLocation())}}catch(t){u=!0,f=t}finally{try{!d&&v.return&&v.return()}finally{if(u)throw f}}var g=!0,p=!1,b=void 0;try{for(var x,A=h[Symbol.iterator]();!(g=(x=A.next()).done);g=!0){var w=x.value,k=!0,M=!1,S=void 0;try{for(var C,U=e[Symbol.iterator]();!(k=(C=U.next()).done);k=!0){var H=C.value;if(w.x===H.x&&w.y===H.y){e.delete(H);break}}}catch(t){M=!0,S=t}finally{try{!k&&U.return&&U.return()}finally{if(M)throw S}}}}catch(t){p=!0,b=t}finally{try{!g&&A.return&&A.return()}finally{if(p)throw b}}return e=Array.from(e)},getAttackRange:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;null===t&&(t=this.loc_by_grid);var e=void 0,i=t.x,n=t.y;e=0===this.atk?new Set:1===this.atk?new Set([{x:i,y:n+1,group:0},{x:i-1,y:n,group:0},{x:i+1,y:n,group:0},{x:i,y:n-1,group:0}]):2===this.atk?new Set([{x:i,y:n+2,group:0},{x:i-1,y:n+1,group:0},{x:i+1,y:n+1,group:0},{x:i-2,y:n,group:0},{x:i+2,y:n,group:0},{x:i-1,y:n-1,group:0},{x:i+1,y:n-1,group:0},{x:i,y:n-2,group:0}]):3===this.atk?new Set([{x:i,y:n+6,group:1},{x:i-1,y:n+5,group:1},{x:i,y:n+5,group:1},{x:i+1,y:n+5,group:1},{x:i,y:n+4,group:1},{x:i-5,y:n+1,group:2},{x:i-6,y:n,group:2},{x:i-5,y:n,group:2},{x:i-4,y:n,group:2},{x:i-5,y:n-1,group:2},{x:i+5,y:n+1,group:3},{x:i+4,y:n,group:3},{x:i+5,y:n,group:3},{x:i+6,y:n,group:3},{x:i+5,y:n-1,group:3},{x:i,y:n-4,group:4},{x:i-1,y:n-5,group:4},{x:i,y:n-5,group:4},{x:i+1,y:n-5,group:4},{x:i,y:n-6,group:4}]):4===this.atk?new Set([{x:i,y:n+7,group:1},{x:i,y:n+6,group:1},{x:i,y:n+5,group:1},{x:i,y:n+4,group:1},{x:i,y:n+3,group:1},{x:i-7,y:n,group:2},{x:i-6,y:n,group:2},{x:i-5,y:n,group:2},{x:i-4,y:n,group:2},{x:i-3,y:n,group:2},{x:i+7,y:n,group:3},{x:i+6,y:n,group:3},{x:i+5,y:n,group:3},{x:i+4,y:n,group:3},{x:i+3,y:n,group:3},{x:i,y:n-3,group:4},{x:i,y:n-4,group:4},{x:i,y:n-5,group:4},{x:i,y:n-6,group:4},{x:i,y:n-7,group:4}]):new Set;var a=!0,o=!1,r=void 0;try{for(var c,s=e[Symbol.iterator]();!(a=(c=s.next()).done);a=!0){var l=c.value;(l.x<0||l.x>this.col_num-1||l.y<0||l.y>this.row_num-1)&&e.delete(l)}}catch(t){o=!0,r=t}finally{try{!a&&s.return&&s.return()}finally{if(o)throw r}}return e=Array.from(e),1===this.camp&&e.reverse(),e},getPlaceRange:function(){var t=[];if(4===this.place)0===this.camp?t.push({x:(this.col_num-1)/2,y:16}):t.push({x:(this.col_num-1)/2,y:0});else if(0===this.camp)for(var e=0;e<this.col_num;e++)for(var i=0;i<2;i++)t.push({x:e,y:10+i+2*(this.place-1)});else for(var n=0;n<this.col_num;n++)for(var a=0;a<2;a++)t.push({x:n,y:6-a-2*(this.place-1)});t=new Set(t);var o=this.father.object_by_loc,r=!0,c=!1,s=void 0;try{for(var l,h=t[Symbol.iterator]();!(r=(l=h.next()).done);r=!0){var _=l.value;o[_.y][_.x][0]&&t.delete(_)}}catch(t){c=!0,s=t}finally{try{!r&&h.return&&h.return()}finally{if(c)throw s}}return t=Array.from(t)},_setDelayAction:function(t){this._action_list.then(this._delay_action(t))},setOtherUnitDelayAction:function(t,e){var i=t.getActionDuration(),n=!0,a=!1,o=void 0;try{for(var r,c=e[Symbol.iterator]();!(n=(r=c.next()).done);n=!0){var s=r.value,l=i-s.getActionDuration();s._setDelayAction(l)}}catch(t){a=!0,o=t}finally{try{!n&&c.return&&c.return()}finally{if(a)throw o}}},setOrderAction:function(){this._action_list.then(this._delay_action(.1)).then(this._move_camera_action()).then(this._delay_action(.1)).then(this._set_mask_action)},setHideMaskAction:function(){this._action_list.then(this._hide_mask_action)},setMoraleUpDownAction:function(t){var e=this.morale,i=Math.max(40,Math.min(100,e+t));this._action_list.then(this._morale_move_to_center_action).then(this._show_morale_action).then(this._morale_decrease_action(e,i)).then(this._morale_move_to_corner_action),this._action_duration+=this._morale_move_to_corner_action_dur},setMoveStepAction:function(){if(this.loc_by_grid.x!==this._tag_loc_by_grid.x){var t=this._tag_loc_by_grid.x-this.loc_by_grid.x;t=t/Math.abs(t)/2,this.loc_by_grid.x+=t,this._action_list.by(.1,{x:48*t})}else if(this.loc_by_grid.y!==this._tag_loc_by_grid.y){var e=this._tag_loc_by_grid.y-this.loc_by_grid.y;e=e/Math.abs(e)/2,this.loc_by_grid.y+=e,this._action_list.by(.1,{y:-48*e})}else this._action_list.delay(.1);return this._action_duration+=.1,this.loc_by_grid.x===this._tag_loc_by_grid.x&&this.loc_by_grid.y===this._tag_loc_by_grid.y&&(this._action_list.then(this._remove_flag_action),!0)},setEncounterFightAction:function(t,e){this.HP=t;var i=t>0?20:-100,n=Math.max(40,Math.min(100,this.morale+i));this.morale=n,this._action_list.then(this._disappear_action).then(this._hide_HP_action).then(this._hide_morale_action).then(this._show_fighting_action).then(this._play_encounter_audio_action(this)).then(this._delay_action(.4)).then(this._play_encounter_audio_action(this)).then(this._delay_action(.4)).then(this._hide_fighting_action).then(this._update_HP_loss_label_action(e)).then(this._show_HP_loss_action).then(this._delay_action(.4)).then(this._hide_HP_loss_action).then(this._update_HP_action(t)).then(this._update_morale_action(n)),0===t?(this._action_list.then(this._appear_action).then(this._show_HP_action).then(this._show_morale_action).then(this._remove_flag_action).then(this._enter_barracks_action),this._action_duration+=this._enter_barracks_action_dur):this._action_list.then(this._delay_action(this._enter_barracks_action_dur)).then(this._appear_action).then(this._show_HP_action).then(this._show_morale_action)},setEncounterDelayAction:function(){this._action_list.then(this._delay_action(1.2+this._enter_barracks_action_dur))},setHideHPAction:function(){this._action_list.then(this._hide_HP_action)},setHideMoraleAction:function(){this._action_list.then(this._hide_morale_action)},_setAttackBeginAction:function(){this._action_list.then(this._move_camera_action()).then(this._show_atk_range_action).then(this._delay_action(.5))},_setAttackOverAction:function(){this._action_list.then(this._hide_atk_range_action)},_setBeAttackedAction:function(t){var e=this._getHPLoss(t,this);this._HP_loss_cache+=e,this._action_list.then(this._move_camera_action()).then(this._disappear_action).then(this._play_attack_audio_action(t)).then(this._show_fighting_action).then(this._delay_action(.1)).then(this._hide_fighting_action).then(this._delay_action(.1)).then(this._show_fighting_action).then(this._delay_action(.1)).then(this._hide_fighting_action).then(this._delay_action(.1)).then(this._show_fighting_action).then(this._delay_action(.1)).then(this._hide_fighting_action).then(this._appear_action).then(this._update_HP_loss_label_action(e)).then(this._show_HP_loss_action).then(this._delay_action(.5)).then(this._hide_HP_loss_action)},setFightAction:function(){this._setAttackBeginAction(),this.setOtherUnitDelayAction(this,this.atk_tag);var t=!0,e=!1,i=void 0;try{for(var a,o=this.atk_tag[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var r=a.value;r._setBeAttackedAction(this);var c=new Set([this].concat(n(this.atk_tag)));c.delete(r),c=Array.from(c),this.setOtherUnitDelayAction(r,c)}}catch(t){e=!0,i=t}finally{try{!t&&o.return&&o.return()}finally{if(e)throw i}}this._setAttackOverAction()},_setHPDecreaseAction:function(){var t=this.HP,e=Math.max(0,this.HP+this._HP_loss_cache);return this._action_list.then(this._HP_move_to_center_action).then(this._show_HP_action).then(this._HP_decrease_action(t,e)).then(this._HP_move_to_corner_action),this._action_duration+=this._HP_move_to_corner_action_dur,e},setRoundOverAction:function(){this._setHPDecreaseAction();var t=0,e=!0,i=!1,n=void 0;try{for(var a,o=this.atk_tag[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var r=a.value;r.camp!==this.camp&&r.HP+r._HP_loss_cache<=0&&(t+=20)}}catch(t){i=!0,n=t}finally{try{!e&&o.return&&o.return()}finally{if(i)throw n}}this.setMoraleUpDownAction(t),0===Math.max(0,this.HP+this._HP_loss_cache)&&(this._action_list.then(this._enter_barracks_action),this._action_duration+=this._enter_barracks_action_dur)},startAction:function(){this._action_list.start()},clearAction:function(){this._action_list=cc.tween(this.node).delay(.1),this._action_duration=.1},_setUsedAction:function(){var t=cc.tween,e=this.father.father,i=e.mark,n=e.order,a=e.father.message;this._click_action=t().to(.05,{scale:.7}).to(.15,{scale:1}),this._cancel_click_action=t().to(.05,{scale:.8}),this._appear_action=t().call(function(){this.img.opacity=255},this),this._show_HP_action=t().call(function(){this.HP_label.node.active=!0},this),this._show_HP_loss_action=t().call(function(){this.HP_loss_label.node.active=!0},this),this._show_morale_action=t().call(function(){this.morale_label.node.active=!0},this),this._show_fighting_action=t().call(function(){this.fighting.active=!0},this),this._show_attack_action=t().call(function(){this.attack.active=!0},this),this._show_atk_range_action=t().call(function(){i.showAttackRangeMark(this)},this),this._disappear_action=t().call(function(){this.img.opacity=0},this),this._hide_HP_loss_action=t().call(function(){this.HP_loss_label.node.active=!1},this),this._hide_mask_action=t().call(this.hideMask,this),this._hide_HP_action=t().call(function(){this.HP_label.node.active=!1},this),this._hide_morale_action=t().call(function(){this.morale_label.node.active=!1},this),this._hide_fighting_action=t().call(function(){this.fighting.active=!1},this),this._hide_attack_action=t().call(function(){this.attack.active=!1},this),this._hide_atk_range_action=t().call(function(){i.hideAttackRangeMark(this)},this),this._remove_flag_action=t().call(function(){n.removeFlag(this._tag_loc_by_grid,this)},this),this._set_command_action=t().call(this.setCommand,this),this._set_mask_action=t().call(this.setMask,this),this._enter_barracks_action=t().call(function(){this.playDeathAudio()},this).repeat(3,t().to(.2,{opacity:0}).to(.2,{opacity:255})).call(this.enterBarracks,this),this._HP_move_to_center_action=t().call(function(){this.HP_label.node.scale=1.5,this.HP_label.node.anchorX=.5,this.HP_label.node.setPosition(0,2)},this),this._HP_move_to_corner_action=t().call(function(){this.HP_label.node.anchorX=1,this.HP_label.node.x+=this.HP_label.node.width/2,cc.tween(this.HP_label.node).to(.2,{scale:1,x:23,y:21}).start()},this).delay(.2),this._morale_move_to_center_action=t().call(function(){this.morale_label.node.scale=1.5,this.morale_label.node.anchorX=.5,this.morale_label.node.setPosition(0,2)},this),this._morale_move_to_corner_action=t().call(function(){this.morale_label.node.anchorX=0,this.morale_label.node.x-=this.morale_label.node.width/2,cc.tween(this.morale_label.node).to(.2,{scale:1,x:-23,y:21}).start()},this).delay(.2),this._click_action_dur=.2,this._cancel_click_action_dur=.05,this._enter_barracks_action_dur=1.2,this._HP_move_to_corner_action_dur=.2,this._morale_move_to_corner_action_dur=.2,this._delay_action=function(e){return this._action_duration+=e,t().delay(e)},this._HP_decrease_action=function(e,i){var n=(e-i)/100;return n>0?(this._action_duration+=.02*n,t().repeat(n,t().call(function(){this.HP-=100,this._HP_loss_cache+=100,this.HP_label.string=this.HP},this).delay(.02))):this._delay_action(.1)},this._morale_decrease_action=function(e,i){var n=Math.abs(e-i),a=(e-i)/n;return n>0?(this._action_duration+=.2*n,t().repeat(n,t().call(function(){this.morale-=a,this._morale_dec_cache+=a,this.morale_label.string=this.morale},this).delay(.2))):this._delay_action(.1)},this._update_HP_action=function(e){return t().call(function(){this._updateHP(e)},this)},this._update_HP_loss_label_action=function(e){return t().call(function(){this._updateHPLossLabel(e)},this)},this._update_morale_action=function(e){return t().call(function(){this._updateMorale(e)},this)},this._play_move_audio_action=function(e){return t().call(function(){e.playMoveAudio()},this)},this._play_attack_audio_action=function(e){return t().call(function(){e.playAttackAudio()},this)},this._play_encounter_audio_action=function(e){return t().call(function(){e.playEncounterAudio()},this)},this._move_camera_action=function(){var i=0+48*((e.col_num-1)/2-this.loc_by_grid.x),n=0-48*((e.row_num-1)/2-this.loc_by_grid.y),o=Math.max(e.location.min_x,Math.min(e.location.max_x,i)),r=Math.max(e.location.min_y,Math.min(e.location.max_y,n)),c=-e.node.width/2+24+48*this.loc_by_grid.x,s=e.node.height/2-24-48*this.loc_by_grid.y,l=(Math.abs(o-e.node.x)+Math.abs(r-e.node.y))/48*.02;return this._action_duration+=l,t().call(function(){t(e.node).to(l,{x:o,y:r}).start()},this).call(function(){t(e.selected).to(l,{x:c,y:s}).start()},this).delay(l).call(function(){a.updateState(this),a.updateMessage(this)},this)}},_randint:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!1===i&&e>t)return[];var n=[],a=void 0;if(i)for(;n.length<e;)a=Math.min(Math.floor(Math.random()*t),t-1),n.push(a);else for(var o=new Set;n.length<e;)a=Math.min(Math.floor(Math.random()*t),t-1),o.size<o.add(a).size&&n.push(a);return 1===e?n[0]:n}}),cc._RF.pop()},{}],u:[function(t,e,i){"use strict";cc._RF.push(e,"d881aPXn/hDI4bV1EBL6RLw","u"),cc.Class({extends:cc.Component,properties:{camp:0,HP:3,max_HP:3,mov:1,atk:1,loc_by_grid:cc.Vec2},onLoad:function(){this.father=cc.find("scene1/battle/army").getComponent("Army"),this.HP_label_string=cc.find("HP_label",this.node).getComponent(cc.Label).string,this.mask=cc.find("mask",this.node),this.setLocation(this.loc_by_grid),this.tag_loc_by_grid=new cc.Vec2(0,0),this.HP_label_string=this.HP,this.command_over=!1,this.selected=0},onEnable:function(){},start:function(){},update:function(t){},lateUpdate:function(t){},onDisable:function(){},beforeDestroy:function(){},onDestroy:function(){},setLocation:function(t){var e=-this.father.node.width/2+24,i=this.father.node.height/2-24;this.node.x=e+48*t.x,this.node.y=i-48*t.y,this.loc_by_grid.x=t.x,this.loc_by_grid.y=t.y}}),cc._RF.pop()},{}]},{},["Army","Battle","Fight","Fight_Anim","Head","Map","Mark","Menu","Message","Order","Scene1","Template","Text","Unit","u"]);