{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\Player.js"],"names":["cc","Class","extends","Component","properties","jumpHeight","jumpDuration","deformationDuration","maxMoveSpeed","accel","jumpAudio","default","type","AudioClip","onLoad","initWidth","node","width","runAction","setJumpAction","accLeft","accRight","xSpeed","systemEvent","on","SystemEvent","EventType","KEY_DOWN","onKeyDownFunc","KEY_UP","onKeyUpFunc","start","update","dt","Math","abs","x","min","xRightBound","parent","xLeftBound","onDestroy","off","squash","scaleTo","stretch","jumpUp","moveBy","v2","easing","easeCubicActionOut","jumpDown","easeCubicActionIn","scaleBack","playJumpSound","callFunc","audioEngine","playEffect","repeatForever","sequence","spawn","event","keyCode","macro","KEY","left","right"],"mappings":"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","file":"Player.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        jumpHeight: 0,          // 主角跳跃高度\r\n        jumpDuration: 0,        // 主角跳跃持续时间\r\n        deformationDuration: 0, // 辅助形变动作时间\r\n        maxMoveSpeed: 0,        // 最大移动速度\r\n        accel: 0,               // 加速度\r\n        jumpAudio: { // 跳跃音效资源\r\n            default: null,\r\n            type: cc.AudioClip,\r\n        },\r\n    },\r\n\r\n    onLoad: function () {\r\n        this.initWidth = this.node.width;\r\n        // 初始化跳跃动作\r\n        this.node.runAction(this.setJumpAction());\r\n        // 加速度方向开关\r\n        this.accLeft = false;\r\n        this.accRight = false;\r\n        // 主角当前水平方向速度\r\n        this.xSpeed = 0;\r\n        // 初始化键盘输入监听\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDownFunc, this);\r\n        cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP, this.onKeyUpFunc, this);\r\n    },\r\n\r\n    start: function () {\r\n\r\n    },\r\n\r\n    update: function (dt) {\r\n        // 根据当前加速度方向每帧更新速度\r\n        if (this.accLeft) {\r\n            this.xSpeed -= this.accel * dt;\r\n        } else if (this.accRight) {\r\n            this.xSpeed += this.accel * dt;\r\n        } else;\r\n        // 限制主角的速度不能超过最大值\r\n        if ( Math.abs(this.xSpeed) > this.maxMoveSpeed ) {\r\n            // if speed reach limit, use max speed with current direction\r\n            this.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed);\r\n        } else;\r\n        // 根据当前速度更新主角的位置\r\n        this.node.x += this.xSpeed * dt;\r\n        // 横向压扁后逐渐还原效果\r\n        if (this.node.width < this.initWidth) {\r\n            this.node.width = Math.min(this.node.width+1, this.initWidth);\r\n        }\r\n        // 碰壁横向压扁效果\r\n        var xRightBound = this.node.parent.width/2 - this.initWidth/2;\r\n        var xLeftBound = -1 * xRightBound;\r\n        if (this.node.x > xRightBound) {\r\n            this.node.x = xRightBound;\r\n            this.node.width *= (1-0.2*Math.abs(this.xSpeed/this.maxMoveSpeed));\r\n            this.xSpeed *= -0.8;\r\n        } else if (this.node.x < xLeftBound) {\r\n            this.node.x = xLeftBound;\r\n            this.node.width *= (1-0.2*Math.abs(this.xSpeed/this.maxMoveSpeed));\r\n            this.xSpeed *= -0.8;\r\n        } else;\r\n    },\r\n\r\n    onDestroy: function () {\r\n        // 取消键盘输入监听\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN, this.onKeyDownFunc, this);\r\n        cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP, this.onKeyUpFunc, this);\r\n    },\r\n\r\n    setJumpAction: function () {\r\n         //压扁\r\n        var squash = cc.scaleTo(this.deformationDuration, 1, 0.6);\r\n         //拉伸\r\n        var stretch = cc.scaleTo(this.deformationDuration, 1, 1.1);\r\n        // 跳跃上升\r\n        var jumpUp = cc.moveBy(this.jumpDuration, cc.v2(0, this.jumpHeight))\r\n                       .easing(cc.easeCubicActionOut());\r\n        // 下落\r\n        var jumpDown = cc.moveBy(this.jumpDuration, cc.v2(0, -this.jumpHeight))\r\n                         .easing(cc.easeCubicActionIn());\r\n        // 缓慢还原\r\n        var scaleBack = cc.scaleTo(this.jumpDuration, 1, 1);\r\n        // 添加一个回调函数，用于在动作结束时调用我们定义的其他方法\r\n        var playJumpSound = cc.callFunc(function () {\r\n            // 调用声音引擎播放声音\r\n            cc.audioEngine.playEffect(this.jumpAudio, false);\r\n        }, this);\r\n        // 不断重复，而且每次完成落地动作后调用回调来播放声音\r\n        return cc.repeatForever(cc.sequence(squash,\r\n                                            stretch,\r\n                                            cc.spawn(jumpUp, scaleBack),\r\n                                            jumpDown,\r\n                                            playJumpSound));\r\n    },\r\n\r\n    onKeyDownFunc: function (event) {\r\n        // set a flag when key pressed\r\n        switch(event.keyCode) {\r\n            case cc.macro.KEY.left:\r\n                this.accLeft = true;\r\n                break;\r\n            case cc.macro.KEY.right:\r\n                this.accRight = true;\r\n                break;\r\n        }\r\n    },\r\n\r\n    onKeyUpFunc: function (event) {\r\n        // unset a flag when key released\r\n        switch(event.keyCode) {\r\n            case cc.macro.KEY.left:\r\n                this.accLeft = false;\r\n                break;\r\n            case cc.macro.KEY.right:\r\n                this.accRight = false;\r\n                break;\r\n        }\r\n    },\r\n});\r\n"]}